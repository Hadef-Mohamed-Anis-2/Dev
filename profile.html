<!DOCTYPE html>
<html lang="er" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="profilestyles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="profile-container">
         <a href="main.html" style="text-decoration: none;">
        <button class="back-btn" aria-label="Return">
            <i class="fas fa-arrow-right"></i>
        </button>
         </a>

        <div class="header-frame frame-one">
            <div class="profile-info">
                <div class="profile-icon" id="profile-icon"></div> 
                <div class="user-details">
                    <span class="username" id="username-display">gest</span> 
                    <div class="subscribers">Subscribers <span>0</span></div>
                </div>
            </div>
            <button class="add-btn" aria-label="Upload Photo" id="upload-btn">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <input type="file" id="file-input" accept="image/*" style="display: none;">

        <div class="main-content-area"> 
            <div class="content-frame frame-two">
                <p class="placeholder-text" id="status-message">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±...</p>
                </div>
            
            <div class="footer-buttons">
                <button class="footer-btn friends-btn">
                    <i class="fas fa-users"></i>
                    <span>Friands</span>
                </button>
                <button class="footer-btn achievements-btn">
                    <i class="fas fa-trophy"></i>
                    <span>Achievements</span>
                </button>
            </div>
        </div>
    </div>

    <script>
    // ****************************************************
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary - ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ù‚ÙŠÙ…Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    // ****************************************************
    const CLOUDINARY_CLOUD_NAME = "dsvxv96q8"; // <=== Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø§Ø³Ù… Ø³Ø­Ø§Ø¨ØªÙƒ
    const CLOUDINARY_UPLOAD_PRESET = "DevGame"; // <=== Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù€ Upload Preset ØºÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹

    // Ù…ÙØ§ØªÙŠØ­ localStorage
    const USER_NAME_KEY = 'game_user_name';
    const PROFILE_PIC_URL_KEY = 'game_profile_pic_url';

    // ****************************************************
    // Ù…Ù†Ø·Ù‚ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    // ****************************************************
    document.addEventListener('DOMContentLoaded', () => {
        const usernameElement = document.getElementById('username-display');
        const profileIcon = document.getElementById('profile-icon');
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('upload-btn');
        
        // 1. ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage
        const savedUsername = localStorage.getItem(USER_NAME_KEY); 
        if (usernameElement) {
            usernameElement.textContent = savedUsername || 'Guest User'; 
        }

        // 2. ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ù† localStorage
        const savedPicUrl = localStorage.getItem(PROFILE_PIC_URL_KEY);
        if (profileIcon && savedPicUrl) {
             profileIcon.style.backgroundImage = `url('${savedPicUrl}')`;
             profileIcon.style.backgroundSize = 'cover';
             profileIcon.style.backgroundPosition = 'center';
             profileIcon.style.backgroundColor = 'transparent'; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        }

        // 3. Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù…Ø¯Ø®Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ÙÙŠ
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // 4. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                uploadImageToCloudinary(file);
            }
        });
    });

    // ****************************************************
    // 5. Ø¯Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ Cloudinary
    // ****************************************************
    function uploadImageToCloudinary(file) {
        const statusMessage = document.getElementById('status-message');
        statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.';
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

        fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ Cloudinary.');
            }
            return response.json();
        })
        .then(data => {
            const imageUrl = data.secure_url;
            
            // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ localStorage
            localStorage.setItem(PROFILE_PIC_URL_KEY, imageUrl); 

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const profileIcon = document.getElementById('profile-icon');
            profileIcon.style.backgroundImage = `url('${imageUrl}')`;
            profileIcon.style.backgroundSize = 'cover';
            profileIcon.style.backgroundPosition = 'center';
            profileIcon.style.backgroundColor = 'transparent';
            
            statusMessage.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰';
            // ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø£Ùˆ Ø£ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø®Ø±Ù‰
        })
        .catch(error => {
            console.error('Upload Error:', error);
            statusMessage.textContent = `ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ${error.message}`;
        });
    }


    // ****************************************************
    // (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
    // ****************************************************
    document.addEventListener('contextmenu', function(e){
        e.preventDefault();
    });

    document.addEventListener('dragstart', function(e){
        if (e.target.tagName == 'IMG'){
            e.preventDefault();
        }
    });
    </script>
</body>

</html>
